@page "/editCars/{Id:int}"
@using CarDetailsBlazor.Interfaces;
@using CarDetailsModels;
@using CarDetailsBlazor;
@using System.Net.Http.Json;
@using System.Net.Http;
@using Microsoft.AspNetCore.Mvc;
@using System.Text.Json;
@inject IMediator _mediatr
@using Manufacturer = CarDetailsAPI.Models.ManufacturersModel;
@using Car = CarDetailsAPI.Models.CarsModel;
@inject ICarWebServiceAPI CarWebServiceAPI
@inject IManufacturerWebServiceAPI ManufacturerWebServiceAPI


<h3>EditCar</h3>
<EditForm Model="newCar" OnValidSubmit="EditCarAndManufacturer">

<div class="container-fluid mb-3">

    <div class="mb-2">
        <label for="carYear">Car Year:</label>
        <input id="carYear" type="text" @bind="newCar.MappedYear" placeholder="Insert value.." />
    </div>
    <div class="mb-2">
        <label for="carManufacturer">Car Manufacturer:</label>
        <input id="carManufacturer" type="text" @bind="newCar.MappedManufacturer" placeholder="Insert value.." />
    </div>
    <div class="mb-2">
        <label for="carName">Car Name:</label>
        <input id="carName" type="text" @bind="newCar.MappedName" placeholder="Insert value.." />
    </div>
    <div class="mb-2">
        <label for="carDisplacement">Car Displacement:</label>
        <input id="carDisplacement" type="number" step="0.1" @bind="newCar.MappedDisplacement" placeholder="Insert value.." />
    </div>
    <div class="mb-2">
        <label for="carCylinders">Car Cylinders:</label>
        <input id="carCylinders" type="number" @bind="newCar.MappedCylinders" placeholder="Insert value.." />
    </div>
    <div class="mb-2">
        <label for="carCity">Car City Fuel Efficiency:</label>
        <input id="carCity" type="text" @bind="newCar.MappedCity" placeholder="Insert value.." />
    </div>
    <div class="mb-2">
        <label for="carHighway">Car Highway Fuel Efficiency:</label>
        <input id="carHighway" type="text" @bind="newCar.MappedHighway" placeholder="Insert value.." />
    </div>
    <div class="mb-2">
        <label for="carCombined">Car Combined Fuel Efficiency:</label>
        <input id="carCombined" type="text" @bind="newCar.MappedCombined" placeholder="Insert value.." />
    </div>
    <button type="submit" @onclick="EditCarAndManufacturer" class="btn btn-success">Save</button>

</div>
</EditForm>

@code {
    [Parameter]
    public int Id { get; set; }

    private Car newCar = new Car();
    private Manufacturer newManufacturer = new Manufacturer();
    private HttpClient httpClient;
    private string statusMessage;


    protected override async Task OnInitializedAsync()
    {
        try
        {
            var response = await CarWebServiceAPI.GetCarById(Id);
            if (response.Car is not null)
            {
                newCar = response.Car;
            }

        }
        catch (Exception e)
        {

            throw;
        }
    }

    private async Task EditCarAndManufacturer()
    {
        try
        {
            await CarWebServiceAPI.UpdateCar(newCar);


            statusMessage = "Car and manufacturer details updated successfully.";

        }
        catch (Exception e)
        {
            statusMessage = "Failed to update car and manufacturer details.";
        }
        
    }

}
