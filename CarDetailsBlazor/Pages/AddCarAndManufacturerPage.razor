@page "/addcar"
@using CarDetailsModels;
@using System.Net.Http.Json;
@using System.Net.Http;

<h3>AddCarAndManufacturer</h3>

<div>
    <form>
        <div>
            <label for="manufacturerName">Manufacturer Name:</label>
            <input id="manufacturerName" type="text" @bind="newManufacturer.Name" />
        </div>
        <div>
            <label for="manufacturerHQ">Manufacturer Headquarters:</label>
            <input id="manufacturerHQ" type="text" @bind="newManufacturer.Headquarters" />
        </div>
        <div>
            <label for="manufacturerYear">Manufacturer Year:</label>
            <input id="manufacturerYear" type="text" @bind="newManufacturer.Year" />
        </div>

    </form>
</div>
<div>
    <form>
        <div>
            <label for="carYear">Car Year:</label>
            <input id="carYear" type="text" @bind="newCar" />
        </div>
        <div>
            <label for="carManufacturer">Car Manufacturer:</label>
            <input id="carManufacturer" type="text"  />
        </div>
        <div>
            <label for="carName">Car Name:</label>
            <input id="carName" type="text"  />
        </div>
        <div>
            <label for="carDisplacement">Car Displacement:</label>
            <input id="carDisplacement" type="number" step="0.1"  />
        </div>
        <div>
            <label for="carCylinders">Car Cylinders:</label>
            <input id="carCylinders" type="number"  />
        </div>
        <div>
            <label for="carCity">Car City Fuel Efficiency:</label>
            <input id="carCity" type="text"  />
        </div>
        <div>
            <label for="carHighway">Car Highway Fuel Efficiency:</label>
            <input id="carHighway" type="text"  />
        </div>
        <div>
            <label for="carCombined">Car Combined Fuel Efficiency:</label>
            <input id="carCombined" type="text"  />
        </div>
        <button type="submit" >Add Car</button>
        <button type="submit" >Add Manufacturer</button>
    </form>
</div>


@code {
    private List<Manufacturer> manufacturers = new List<Manufacturer>();
    private Manufacturer newManufacturer = new Manufacturer();
    private Car newCar = new Car();
    private HttpClient httpClient;

    protected override async Task OnInitializedAsync()
    {
        // initialize HttpClient
        httpClient = new HttpClient();

        // fetch existing manufacturers
        manufacturers = await httpClient.GetFromJsonAsync<List<Manufacturer>>("api/manufacturers");
    }

    private async Task AddManufacturer()
    {
        // add new manufacturer to database
        await httpClient.PostAsJsonAsync<Manufacturer>("api/manufacturers", newManufacturer);

        // clear form fields and update list of manufacturers
        newManufacturer = new Manufacturer();
        manufacturers = await httpClient.GetFromJsonAsync<List<Manufacturer>>("api/manufacturers");
    }

    private async Task AddCar()
    {
        // add new car to database
        await httpClient.PostAsJsonAsync<Car>("api/cars", newCar);

        // clear form fields
        newCar = new Car();
    }
}